<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings View</title>

    <script src="../src/home.js"></script>
    <link rel="stylesheet" href="../styles/home.css">
</head>
<body>

<div class="tags">
    <button>
        <a href="../home.html"> <img id="daily-tag" src="../images/tag.png" alt=""></a>
    </button>
    <button>
        <a href="../Notebook_sites/weekly-site.html"> <img id="weekly-tag" src="../images/tag.png" alt=""></a>
    </button>
    <button>
        <a href="../Notebook_sites/monthly-site.html"> <img id="monthly-tag" src="../images/tag.png" alt=""></a>
    </button>
    <button>
        <a href="../Notebook_sites/settings-site.html"> <img  id="settings-tag" src="../images/tag.png" alt=""></a>
    </button>
</div>
<div class="note-book">
    <div class="inner-notebook">
            <h1 style="padding: 10px 10px 10px 40px;">Settings</h1>
            <div id="settings-notebook">
                <div class="options">
                    <button class="opt-button" id="account-settings">Account Settings</button>
                    <button class="opt-button" id="appearance">Appearance</button>
                    <button class="opt-button" id="about-us">About us</button>
                    <button class="opt-button" onclick="logout()" id="logout-btn">Logout</button>
                    <button style="color:darkred" class="opt-button" id="deleteAccount" onclick="deleteAccount()">Delete Account</button>
                </div>
                <div class="content">
                    <div id="account-settings-content">
                        <form id="settingsForm">
                            <label for="username">Username:</label>
                            <input type="text" id="username" name="username" required><br><br>
                            <label for="password">Password:</label>
                            <input type="password" id="password" name="password" required><br><br>

                            <input type="checkbox" id="trackPeriod">
                            <label for="trackPeriod">Track Periods</label>
                            <br><br>

                            <input type="submit" id="submit_settings" value="Submit Settings">
                        </form>
                    </div>
                    <div id="appearance-content">
                        <p>themes:</p>
                    </div>
                    <div id="about-us-content">
                        <p>about us</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
loadSettings();
document.addEventListener("DOMContentLoaded", () => {
    const track = document.getElementById('trackPeriod');
    const currentTrack = localStorage.getItem('trackPeriod');

    if (currentTrack) {
        track.checked = true;
    }

    const form = document.getElementById('settingsForm');
    form.addEventListener('submit', (event) => {
        event.preventDefault(); // Prevent the default form submission
        submitSettings();
    });
});


async function submitSettings() {
    const track = document.getElementById('trackPeriod');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const token = localStorage.getItem('token');
    const newUsername= usernameInput.value;
    if (track.checked) {
        localStorage.setItem('trackPeriod', 'true');
    } else {
        localStorage.removeItem('trackPeriod');
    }
    if(localStorage.getItem('username') !== usernameInput.value){
        try {
            const response = await fetch("http://localhost:3000/auth/change-username", {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify(newUsername)
            });
            logout()
        } catch (error) {
            console.error("Error submitting week data:", error);
        }
    }

}
</script>
</body>
</html>